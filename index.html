<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Extrair Vagas</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <div class="container">
    <div class="block">
      <h2>Mensagem Inicial:</h2>
      <textarea id="input-msg-start">ğŸ™ Antes de qualquer coisa, gostarÃ­amos muito de agradecer pelo interesse em integrar Ã  nossa equipe.

ğŸ’» Para cadastro de currÃ­culos somente pelo nosso site: www.grupobarralcool.com.br/vagas. No portal informamos os requisitos da vaga e benefÃ­cios.

âš ï¸ Com o cadastro no site e novas vagas abertas, nosso time de RH realiza a busca em nosso banco de dados. Logo, se o currÃ­culo estiver cadastrado, as chances em visualizarmos e entrarmos em contato serÃ¡ maior.

ğŸ“¢ Em tempo, informamos que temos vagas disponÃ­veis:</textarea> 
    </div>

    <div class="block">
      <h2>Mensagem Final:</h2>
      <textarea id="input-msg-end">Das vagas acima qual gostaria de se candidatar?</textarea> 
    </div>

    <div class="block">
      <h2>Cole o HTML aqui:</h2>
      <textarea id="inputHTML"></textarea> 
      <button onclick="extrairVagas()">GERAR</button>
    </div>

    <div class="block">
      <h2>Vagas Formatadas:</h2>
      <textarea id="mensagem" readonly></textarea>
      <button onclick="copiarTexto()">COPIAR</button>
    </div>

  </div>

<script>
    function extrairVagas() {
      const html = document.getElementById('inputHTML').value;
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');

      const msgStart = document.getElementById('input-msg-start').value;
      const msgEnd = document.getElementById('input-msg-end').value;

      if (!html || !msgStart || !msgEnd) {
        alert('Por favor, preencha todos os campos.');
        return;
      }

      // Salvar no localStorage
      localStorage.setItem('msgStart', msgStart);
      localStorage.setItem('msgEnd', msgEnd);
      

      const linhas = doc.querySelectorAll('tr.an-linha-grid');
      let textoVagas = msgStart + '\n\n';

      let contador = 1;

      linhas.forEach(linha => {
        let descVaga = linha.querySelector('.an-coluna-DESVAG')?.textContent.trim() || '';
        let numVagasRaw = linha.querySelector('.an-coluna-NUMVAG')?.textContent.trim() || '';

        let numVagas = numVagasRaw.replace(/Qtd:\s*/i, '').replace(/[^\d]/g, '');
        descVaga = descVaga.replace(/ğŸ”¶/g, '').trim();

        if (descVaga && numVagas !== '') {
          textoVagas += `ğŸ”¶ ${contador}. ${descVaga} (${numVagas})\n`;
          contador++;
        }
      });

      textoVagas += '\n' + msgEnd;
      document.getElementById('mensagem').value = textoVagas;
    }

    function copiarTexto() {
      const mensagem = document.getElementById('mensagem');
      mensagem.select();
      mensagem.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(mensagem.value);
      alert('Texto copiado para a Ã¡rea de transferÃªncia!');
    }
</script>

</body>
</html>
