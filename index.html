<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Extrair Vagas</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <div class="container">
    <div class="block">
      <h2>Mensagem Inicial:</h2>
      <textarea id="input-msg-start">🙏 Antes de qualquer coisa, gostaríamos muito de agradecer pelo interesse em integrar à nossa equipe.

💻 Para cadastro de currículos somente pelo nosso site: www.grupobarralcool.com.br/vagas. No portal informamos os requisitos da vaga e benefícios.

⚠️ Com o cadastro no site e novas vagas abertas, nosso time de RH realiza a busca em nosso banco de dados. Logo, se o currículo estiver cadastrado, as chances em visualizarmos e entrarmos em contato será maior.

📢 Em tempo, informamos que temos vagas disponíveis:</textarea> 
    </div>

    <div class="block">
      <h2>Mensagem Final:</h2>
      <textarea id="input-msg-end">Das vagas acima qual gostaria de se candidatar?</textarea> 
    </div>

    <div class="block">
      <h2>Cole o HTML aqui:</h2>
      <textarea id="inputHTML"></textarea> 
      <button onclick="extrairVagas()">GERAR</button>
    </div>

    <div class="block">
      <h2>Vagas Formatadas:</h2>
      <textarea id="mensagem" readonly></textarea>
      <button onclick="copiarTexto()">COPIAR</button>
    </div>

  </div>

<script>
    function extrairVagas() {
        const html = document.getElementById('inputHTML').value;
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        const msgStart = document.getElementById('input-msg-start').value;
        const msgEnd = document.getElementById('input-msg-end').value;

        if (!html || !msgStart || !msgEnd) {
            alert('Por favor, preencha todos os campos.');
            return;
        }

        localStorage.setItem('msgStart', msgStart);
        localStorage.setItem('msgEnd', msgEnd);

        const linhas = doc.querySelectorAll('tr.an-linha-grid');
        let textoVagas = msgStart + '\n\n';

        let contador = 1;

        linhas.forEach(linha => {
            const colunas = linha.querySelectorAll('td');

            const descricao = colunas[1]?.textContent.replace(/🔶/g, '').trim() || '';
            const numeroVagas = colunas[6]?.textContent.replace(/[^\d]/g, '') || '';

            if (descricao && numeroVagas !== '0') {
                textoVagas += `🔶 ${contador}. ${descricao} (${numeroVagas})\n`;
                contador++;
            }
        });

        textoVagas += '\n' + msgEnd;
        document.getElementById('mensagem').value = textoVagas;
    }

    function copiarTexto() {
        const mensagem = document.getElementById('mensagem');
        mensagem.select();
        navigator.clipboard.writeText(mensagem.value);
        alert('Texto copiado para a área de transferência!');
    }
</script>


</body>
</html>
